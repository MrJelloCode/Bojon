window.onload = async () => {
  try {
    // Call your backend to get game results
    const res = await fetch('/get-results');
    const data = await res.json();

    console.log("Received result:", data);

    const { yourScore, opponentScore, yourElo, opponentElo } = data;

    // Determine win/loss/draw
    let resultText = '';
    let actual = 0;
    if (yourScore > opponentScore) {
      resultText = "ðŸŽ‰ You Win!";
      actual = 1;
    } else if (yourScore < opponentScore) {
      resultText = "ðŸ˜ž You Lose!";
      actual = 0;
    } else {
      resultText = "ðŸ¤ It's a Draw!";
      actual = 0.5;
    }

    // Calculate ELO
    const K = 32;
    const expected = 1 / (1 + Math.pow(10, (opponentElo - yourElo) / 400));
    const newElo = Math.round(yourElo + K * (actual - expected));
    const eloChange = newElo - yourElo;

    // Inject data into HTML
    document.getElementById("result-header").textContent = resultText;
    document.getElementById("your-score").textContent = `Your Score: ${yourScore}`;
    document.getElementById("opponent-score").textContent = `Opponent's Score: ${opponentScore}`;
    document.getElementById("elo-change").textContent = `New Elo: ${newElo} (${eloChange >= 0 ? '+' : ''}${eloChange})`;

    // Hide loader, show result
    document.getElementById("loading").style.display = "none";
    const resultContainer = document.getElementById("results-container");
    resultContainer.style.display = "flex";

  } catch (err) {
    console.error("Error fetching results:", err);
    document.getElementById("loading").innerHTML = "<p style='color: red;'>Failed to load results. Try again later.</p>";
  }
};
